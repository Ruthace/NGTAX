import React, { useState, useRef } from 'react';

export default function TaxCalculator() {
  const [monthlyIncome, setMonthlyIncome] = useState('');
  const [pension, setPension] = useState('');
  const [nhis, setNhis] = useState('');
  const [nhf, setNhf] = useState('');
  const [lifeInsurance, setLifeInsurance] = useState('');
  const [mortgage, setMortgage] = useState('');
  const [results, setResults] = useState(null);
  const [activeFaq, setActiveFaq] = useState(null);
  const resultsRef = useRef(null);

  const faqData = [
    {
      question: "What is PAYE tax?",
      answer: "PAYE (Pay As You Earn) is a method of tax collection where employers deduct income tax directly from employees' salaries before payment. For remote workers, you may need to calculate and remit this yourself."
    },
    {
      question: "Am I exempt from paying tax in Nigeria?",
      answer: "You're exempt if you earn the national minimum wage or less, or if your annual taxable income (after deductions) is ‚Ç¶800,000 or below. Gifts are also tax-exempt."
    },
    {
      question: "What deductions can I claim as a remote worker?",
      answer: "You can claim pension contributions (8% of gross income), National Health Insurance premiums, National Housing Fund (2.5%), life insurance premiums, and mortgage interest on your primary residence. The Consolidated Relief Allowance (CRA) is also automatically deducted."
    },
    {
      question: "How is my tax calculated?",
      answer: "Nigeria uses progressive tax rates on your annual taxable income: 7% on first ‚Ç¶300k, 11% on next ‚Ç¶300k, 15% on next ‚Ç¶500k, 19% on next ‚Ç¶500k, 21% on next ‚Ç¶1.6m, and 24% above ‚Ç¶3.2m."
    },
    {
      question: "What is Consolidated Relief Allowance (CRA)?",
      answer: "CRA is the higher of either 1% of your gross income or ‚Ç¶200,000 plus 20% of your gross income. This is automatically deducted from your income before calculating tax."
    },
    {
      question: "Do I need to file tax returns as a remote worker?",
      answer: "Yes, if you're self-employed or work remotely for foreign companies, you should register with FIRS (Federal Inland Revenue Service) and file annual tax returns, even if your employer deducts PAYE."
    },
    {
      question: "Can I claim home office expenses?",
      answer: "While not explicitly listed as standard deductions, some expenses may be deductible. Consult with a tax professional about specific work-related expenses for remote workers."
    },
    {
      question: "What happens if I don't pay my taxes?",
      answer: "Non-payment of taxes can result in penalties, interest charges, and legal consequences. It's important to file and pay on time or arrange payment plans with FIRS if needed."
    }
  ];

  const toggleFaq = (index) => {
    setActiveFaq(activeFaq === index ? null : index);
  };

  const handlePrint = () => {
    window.print();
  };

  const handleSave = () => {
    if (!results) return;
    
    const resultText = `
NIGERIA TAX CALCULATION RESULTS
================================
Date: ${new Date().toLocaleDateString('en-NG')}

INCOME DETAILS:
Monthly Gross Income: ${formatCurrency(results.grossIncome)}
Annual Gross Income: ${formatCurrency(results.grossIncome * 12)}

DEDUCTIONS:
Total Monthly Deductions: ${formatCurrency(results.totalDeductions)}
Total Annual Deductions: ${formatCurrency(results.totalDeductions * 12)}

TAXABLE INCOME:
Monthly Taxable Income: ${formatCurrency(results.taxableIncome)}
Annual Taxable Income: ${formatCurrency(results.annualTaxable)}

TAX CALCULATION:
Monthly PAYE Tax: ${formatCurrency(results.monthlyTax)}
Annual PAYE Tax: ${formatCurrency(results.annualTax)}

NET INCOME:
Net Monthly Income: ${formatCurrency(results.netIncome)}
Net Annual Income: ${formatCurrency(results.netIncome * 12)}

================================
Generated by NGTaxCalc - For informational purposes only
    `;
    
    const blob = new Blob([resultText], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `tax-calculation-${new Date().toISOString().split('T')[0]}.txt`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
  };

  const calculateTax = () => {
    const income = parseFloat(monthlyIncome) || 0;
    const pensionAmount = parseFloat(pension) || (income * 0.08);
    const nhisAmount = parseFloat(nhis) || 0;
    const nhfAmount = parseFloat(nhf) || (income * 0.025);
    const lifeInsuranceAmount = parseFloat(lifeInsurance) || 0;
    const mortgageAmount = parseFloat(mortgage) || 0;
    
    const cra = Math.max(income * 12 * 0.01, 200000 + (income * 12 * 0.20));
    const totalDeductions = (pensionAmount * 12) + (nhisAmount * 12) + (nhfAmount * 12) + 
                           (lifeInsuranceAmount * 12) + (mortgageAmount * 12) + cra;
    const annualGross = income * 12;
    const taxableIncome = Math.max(0, annualGross - totalDeductions);
    
    let tax = 0;
    
    if (taxableIncome <= 300000) {
      tax = taxableIncome * 0.07;
    } else if (taxableIncome <= 600000) {
      tax = (300000 * 0.07) + ((taxableIncome - 300000) * 0.11);
    } else if (taxableIncome <= 1100000) {
      tax = (300000 * 0.07) + (300000 * 0.11) + ((taxableIncome - 600000) * 0.15);
    } else if (taxableIncome <= 1600000) {
      tax = (300000 * 0.07) + (300000 * 0.11) + (500000 * 0.15) + ((taxableIncome - 1100000) * 0.19);
    } else if (taxableIncome <= 3200000) {
      tax = (300000 * 0.07) + (300000 * 0.11) + (500000 * 0.15) + (500000 * 0.19) + 
            ((taxableIncome - 1600000) * 0.21);
    } else {
      tax = (300000 * 0.07) + (300000 * 0.11) + (500000 * 0.15) + (500000 * 0.19) + 
            (1600000 * 0.21) + ((taxableIncome - 3200000) * 0.24);
    }
    
    const monthlyTax = tax / 12;
    const netMonthly = income - monthlyTax - pensionAmount - nhisAmount - nhfAmount - 
                       lifeInsuranceAmount - mortgageAmount;
    
    setResults({
      grossIncome: income,
      totalDeductions: totalDeductions / 12,
      taxableIncome: taxableIncome / 12,
      annualTaxable: taxableIncome,
      monthlyTax: monthlyTax,
      annualTax: tax,
      netIncome: netMonthly
    });
  };

  const formatCurrency = (amount) => {
    return '‚Ç¶' + amount.toLocaleString('en-NG', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
  };

  return (
    <div className="min-h-screen bg-gray-50">
      <style>{`
        @media print {
          body * {
            visibility: hidden;
          }
          .print\\:block {
            display: block !important;
          }
          div[class*="resultsRef"] * {
            visibility: visible;
          }
          div[class*="resultsRef"] {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
          }
          .print\\:hidden {
            display: none !important;
          }
          .print\\:border {
            border: 1px solid #d1d5db !important;
          }
          .print\\:border-gray-300 {
            border-color: #d1d5db !important;
          }
          .print\\:mb-6 {
            margin-bottom: 1.5rem !important;
          }
        }
      `}</style>
      {/* Header */}
      <header className="bg-gradient-to-r from-emerald-500 to-teal-600 text-white shadow-lg">
        <div className="max-w-7xl mx-auto px-4 py-4">
          <div className="flex justify-between items-center flex-wrap gap-4">
            <div>
              <h1 className="text-2xl md:text-3xl font-bold">
                NG<span className="font-light">TaxCalc</span>
              </h1>
            </div>
            <nav>
              <ul className="flex gap-6">
                <li><a href="#home" className="hover:opacity-80 transition">Home</a></li>
                <li><a href="#calculator" className="hover:opacity-80 transition">Calculator</a></li>
                <li><a href="#info" className="hover:opacity-80 transition">Tax Info</a></li>
              </ul>
            </nav>
          </div>
        </div>
      </header>

      {/* Hero Section */}
      <section id="home" className="bg-gradient-to-r from-emerald-500 to-teal-600 text-white py-12">
        <div className="max-w-7xl mx-auto px-4 text-center">
          <h2 className="text-3xl md:text-4xl font-bold mb-4">Remote Worker Tax Calculator</h2>
          <p className="text-lg opacity-95 max-w-3xl mx-auto">
            Calculate your PAYE tax accurately based on Nigeria tax rates. Input your monthly income 
            and allowable deductions to get instant results.
          </p>
        </div>
      </section>

      {/* Calculator Section */}
      <section id="calculator" className="py-16">
        <div className="max-w-4xl mx-auto px-4">
          <div className="bg-white rounded-2xl shadow-xl overflow-hidden">
            <div className="bg-gradient-to-r from-emerald-500 to-teal-600 text-white p-8 text-center">
              <h3 className="text-2xl md:text-3xl font-bold mb-2">Calculate Your Tax</h3>
              <p className="text-lg opacity-90">For Remote Workers in Nigeria</p>
            </div>
            
            <div className="p-8">
              <div>
                <div className="mb-6">
                  <label className="block mb-2 font-semibold text-emerald-600">
                    Monthly Gross Income (‚Ç¶)
                  </label>
                  <input
                    type="number"
                    value={monthlyIncome}
                    onChange={(e) => setMonthlyIncome(e.target.value)}
                    placeholder="Enter your monthly income"
                    className="w-full p-4 border-2 border-gray-200 rounded-lg focus:border-emerald-500 focus:outline-none transition"
                    min="0"
                  />
                  <small className="block mt-1 text-gray-600 text-sm">
                    Your total monthly earnings before any deductions
                  </small>
                </div>

                <div className="bg-gray-50 p-6 rounded-xl mb-6">
                  <h4 className="text-lg font-semibold text-emerald-600 mb-4">
                    Allowable Deductions (Optional)
                  </h4>
                  
                  <div className="mb-4">
                    <label className="block mb-2 font-semibold text-emerald-600">
                      Pension Contribution (‚Ç¶)
                    </label>
                    <input
                      type="number"
                      value={pension}
                      onChange={(e) => setPension(e.target.value)}
                      placeholder="8% of monthly income (auto-calculated)"
                      className="w-full p-4 border-2 border-gray-200 rounded-lg focus:border-emerald-500 focus:outline-none transition"
                      min="0"
                    />
                    <small className="block mt-1 text-gray-600 text-sm">
                      Contribution to PFA (Pension Fund Administrator)
                    </small>
                  </div>

                  <div className="mb-4">
                    <label className="block mb-2 font-semibold text-emerald-600">
                      National Health Insurance (‚Ç¶)
                    </label>
                    <input
                      type="number"
                      value={nhis}
                      onChange={(e) => setNhis(e.target.value)}
                      placeholder="Enter NHIS contribution"
                      className="w-full p-4 border-2 border-gray-200 rounded-lg focus:border-emerald-500 focus:outline-none transition"
                      min="0"
                    />
                    <small className="block mt-1 text-gray-600 text-sm">
                      Your health insurance premium
                    </small>
                  </div>

                  <div className="mb-4">
                    <label className="block mb-2 font-semibold text-emerald-600">
                      National Housing Fund (‚Ç¶)
                    </label>
                    <input
                      type="number"
                      value={nhf}
                      onChange={(e) => setNhf(e.target.value)}
                      placeholder="2.5% of monthly income"
                      className="w-full p-4 border-2 border-gray-200 rounded-lg focus:border-emerald-500 focus:outline-none transition"
                      min="0"
                    />
                    <small className="block mt-1 text-gray-600 text-sm">
                      Contribution to National Housing Fund
                    </small>
                  </div>

                  <div className="mb-4">
                    <label className="block mb-2 font-semibold text-emerald-600">
                      Life Insurance Premium (‚Ç¶)
                    </label>
                    <input
                      type="number"
                      value={lifeInsurance}
                      onChange={(e) => setLifeInsurance(e.target.value)}
                      placeholder="Enter life insurance premium"
                      className="w-full p-4 border-2 border-gray-200 rounded-lg focus:border-emerald-500 focus:outline-none transition"
                      min="0"
                    />
                    <small className="block mt-1 text-gray-600 text-sm">
                      Life insurance or annuity premiums
                    </small>
                  </div>

                  <div className="mb-4">
                    <label className="block mb-2 font-semibold text-emerald-600">
                      Mortgage Interest (‚Ç¶)
                    </label>
                    <input
                      type="number"
                      value={mortgage}
                      onChange={(e) => setMortgage(e.target.value)}
                      placeholder="Enter mortgage interest"
                      className="w-full p-4 border-2 border-gray-200 rounded-lg focus:border-emerald-500 focus:outline-none transition"
                      min="0"
                    />
                    <small className="block mt-1 text-gray-600 text-sm">
                      Interest on owner-occupied residential housing
                    </small>
                  </div>
                </div>

                <button
                  onClick={calculateTax}
                  className="w-full bg-gradient-to-r from-emerald-500 to-teal-600 text-white p-4 text-lg font-semibold rounded-lg hover:-translate-y-1 transition-transform shadow-lg"
                >
                  Calculate Tax
                </button>
              </div>

              {results && (
                <div ref={resultsRef} className="mt-8 p-6 bg-gradient-to-r from-emerald-50 to-teal-50 rounded-xl border-l-4 border-emerald-500 print:border print:border-gray-300">
                  <div className="flex justify-between items-center mb-4 print:mb-6">
                    <h4 className="text-2xl font-bold text-emerald-600">Your Tax Breakdown</h4>
                    <div className="flex gap-2 print:hidden">
                      <button
                        onClick={handleSave}
                        className="px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition flex items-center gap-2"
                      >
                        <span>üíæ</span> Save
                      </button>
                      <button
                        onClick={handlePrint}
                        className="px-4 py-2 bg-teal-600 text-white rounded-lg hover:bg-teal-700 transition flex items-center gap-2"
                      >
                        <span>üñ®Ô∏è</span> Print
                      </button>
                    </div>
                  </div>
                  
                  <div className="hidden print:block mb-4 text-sm text-gray-600">
                    Calculation Date: {new Date().toLocaleDateString('en-NG', { year: 'numeric', month: 'long', day: 'numeric' })}
                  </div>
                  
                  <div className="space-y-3">
                    <div className="flex justify-between py-3 border-b border-emerald-200">
                      <span className="text-gray-700">Monthly Gross Income:</span>
                      <span className="font-semibold">{formatCurrency(results.grossIncome)}</span>
                    </div>
                    <div className="flex justify-between py-3 border-b border-emerald-200">
                      <span className="text-gray-700">Total Deductions:</span>
                      <span className="font-semibold">{formatCurrency(results.totalDeductions)}</span>
                    </div>
                    <div className="flex justify-between py-3 border-b border-emerald-200">
                      <span className="text-gray-700">Taxable Income:</span>
                      <span className="font-semibold">{formatCurrency(results.taxableIncome)}</span>
                    </div>
                    <div className="flex justify-between py-3 border-b border-emerald-200">
                      <span className="text-gray-700">Annual Taxable Income:</span>
                      <span className="font-semibold">{formatCurrency(results.annualTaxable)}</span>
                    </div>
                    <div className="flex justify-between py-3 border-b border-emerald-200">
                      <span className="text-gray-700">Monthly PAYE Tax:</span>
                      <span className="font-semibold">{formatCurrency(results.monthlyTax)}</span>
                    </div>
                    <div className="flex justify-between py-3 border-b border-emerald-200">
                      <span className="text-gray-700">Annual Tax:</span>
                      <span className="font-semibold">{formatCurrency(results.annualTax)}</span>
                    </div>
                    <div className="flex justify-between py-4 text-lg">
                      <span className="font-semibold text-emerald-600">Net Monthly Income:</span>
                      <span className="font-bold text-emerald-600">{formatCurrency(results.netIncome)}</span>
                    </div>
                  </div>
                </div>
              )}
            </div>
          </div>
        </div>
      </section>

      {/* FAQ Section */}
      <section className="py-16 bg-gray-50">
        <div className="max-w-4xl mx-auto px-4">
          <h2 className="text-3xl font-bold text-center text-emerald-600 mb-4">
            Frequently Asked Questions
          </h2>
          <p className="text-center text-gray-600 mb-12">
            Common questions about tax calculations for remote workers in Nigeria
          </p>
          
          <div className="space-y-4">
            {faqData.map((faq, index) => (
              <div key={index} className="bg-white rounded-xl shadow-md overflow-hidden">
                <button
                  onClick={() => toggleFaq(index)}
                  className="w-full px-6 py-4 text-left flex justify-between items-center hover:bg-gray-50 transition"
                >
                  <span className="font-semibold text-gray-800 pr-4">{faq.question}</span>
                  <span className={`text-emerald-600 text-2xl flex-shrink-0 transition-transform ${activeFaq === index ? 'rotate-180' : ''}`}>
                    ‚åÑ
                  </span>
                </button>
                {activeFaq === index && (
                  <div className="px-6 py-4 bg-emerald-50 border-t border-emerald-100">
                    <p className="text-gray-700 leading-relaxed">{faq.answer}</p>
                  </div>
                )}
              </div>
            ))}
          </div>
        </div>
      </section>

      {/* Info Section */}
      <section id="info" className="py-16 bg-white">
        <div className="max-w-7xl mx-auto px-4">
          <h2 className="text-3xl font-bold text-center text-emerald-600 mb-12">
            Nigeria PAYE Tax Information
          </h2>
          <div className="grid md:grid-cols-3 gap-8">
            <div className="bg-gray-50 p-6 rounded-xl border-l-4 border-emerald-500">
              <h3 className="text-xl font-bold text-emerald-600 mb-4">Tax Exemptions</h3>
              <ul className="space-y-2">
                <li className="flex items-start">
                  <span className="text-emerald-500 font-bold mr-2">‚úì</span>
                  <span>Minimum wage earners (exempt)</span>
                </li>
                <li className="flex items-start">
                  <span className="text-emerald-500 font-bold mr-2">‚úì</span>
                  <span>Annual income up to ‚Ç¶800,000 taxable income (exempt)</span>
                </li>
                <li className="flex items-start">
                  <span className="text-emerald-500 font-bold mr-2">‚úì</span>
                  <span>Gifts (exempt)</span>
                </li>
              </ul>
            </div>
            
            <div className="bg-gray-50 p-6 rounded-xl border-l-4 border-emerald-500">
              <h3 className="text-xl font-bold text-emerald-600 mb-4">Allowable Deductions</h3>
              <ul className="space-y-2">
                <li className="flex items-start">
                  <span className="text-emerald-500 font-bold mr-2">‚úì</span>
                  <span>Pension contribution (PFA)</span>
                </li>
                <li className="flex items-start">
                  <span className="text-emerald-500 font-bold mr-2">‚úì</span>
                  <span>National Health Insurance</span>
                </li>
                <li className="flex items-start">
                  <span className="text-emerald-500 font-bold mr-2">‚úì</span>
                  <span>National Housing Fund</span>
                </li>
                <li className="flex items-start">
                  <span className="text-emerald-500 font-bold mr-2">‚úì</span>
                  <span>Life insurance premiums</span>
                </li>
                <li className="flex items-start">
                  <span className="text-emerald-500 font-bold mr-2">‚úì</span>
                  <span>Mortgage interest</span>
                </li>
              </ul>
            </div>
            
            <div className="bg-gray-50 p-6 rounded-xl border-l-4 border-emerald-500">
              <h3 className="text-xl font-bold text-emerald-600 mb-4">Tax Rates (Annual)</h3>
              <ul className="space-y-2">
                <li className="flex items-start">
                  <span className="text-emerald-500 font-bold mr-2">‚úì</span>
                  <span>First ‚Ç¶300,000: 7%</span>
                </li>
                <li className="flex items-start">
                  <span className="text-emerald-500 font-bold mr-2">‚úì</span>
                  <span>Next ‚Ç¶300,000: 11%</span>
                </li>
                <li className="flex items-start">
                  <span className="text-emerald-500 font-bold mr-2">‚úì</span>
                  <span>Next ‚Ç¶500,000: 15%</span>
                </li>
                <li className="flex items-start">
                  <span className="text-emerald-500 font-bold mr-2">‚úì</span>
                  <span>Next ‚Ç¶500,000: 19%</span>
                </li>
                <li className="flex items-start">
                  <span className="text-emerald-500 font-bold mr-2">‚úì</span>
                  <span>Next ‚Ç¶1,600,000: 21%</span>
                </li>
                <li className="flex items-start">
                  <span className="text-emerald-500 font-bold mr-2">‚úì</span>
                  <span>Above ‚Ç¶3,200,000: 24%</span>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      <footer className="bg-gray-800 text-white text-center py-8">
        <div className="max-w-7xl mx-auto px-4">
          <p>&copy; 2025 NGTaxCalc. For informational purposes only. Consult a tax professional for advice.</p>
        </div>
      </footer>
    </div>
  );
}
